<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deepexi.channel.mapper.DistributorGradeMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.deepexi.channel.domain.distributor.DistributorGradeDO">
        <result column="id" property="id" />
        <result column="tenant_id" property="tenantId" />
        <result column="app_id" property="appId" />
        <result column="dr" property="dr" />
        <result column="created_time" property="createdTime" />
        <result column="updated_time" property="updatedTime" />
        <result column="created_by" property="createdBy" />
        <result column="update_by" property="updatedBy" />
        <result column="version" property="version" />
        <result column="remark" property="remark" />
        <result column="parent_id" property="parentId" />
        <result column="root" property="root" />
        <result column="distributor_grade_name" property="distributorGradeName" />
        <result column="distributor_grade+gode" property="distributorGradeCode" />
        <result column="grade_system_id" property="gradeSystemId" />
    </resultMap>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id,
        tenant_id,
        app_id,
        dr,
        created_time,
        updated_time,
        created_by,
        updated_by
    </sql>

    <select id="listGradePage" parameterType="com.deepexi.channel.domain.distributor.DistributorGradeQuery"
            resultType="com.deepexi.channel.domain.distributor.DistributorGradeListDO">
            SELECT
                c.*, d.*
            FROM
                (
                    SELECT
                        a.*
                    FROM
                        cc_distributor_grade a
                    WHERE
                        a.dr = 1
                    AND a.tenant_id = #{tenant_id}
                    AND a.app_id = #{appId}
                ) c
            LEFT JOIN (
                SELECT
                    b.id,
                    b.grade_system_name,
                    b.grade_system_code
                FROM
                    cc_distributor_grade_system b
                WHERE
                    b.dr = 1
                AND b.tenant_id = #{tenant_id}
                AND b.app_id = #{appId}
            ) d ON c.grade_system_id = d.id
            WHERE 1=1
            <if test="distributorGradeCode!=null">
                AND c.distributor_grade_code = #{distributorGradeCode}
            </if>
            <if test="distributorGradeName!=null">
                <bind name="pattern" value="'%'+distributorGradeName+'%'"/>
                AND c.distributor_grade_name LIKE #{pattern}
            </if>
            <if test="gradeSystemCode!=null">
                AND c.grade_system_code = #{gradeSystemCode}
            </if>
            <if test="gradeSystemName!=null">
                <bind name="pattern" value="'%'+gradeSystemName+'%'"/>
                AND d.grade_system_name LIKE #{pattern}
            </if>
            <if test="startTime!=null">
                AND c.updated_time <![CDATA[ >= ]]>#{updateStartTime}
            </if>
            <if test="endTime!=null">
                AND c.updated_time <![CDATA[ <= ]]>#{updateEndTime}
            </if>
            <if test="tenantId!=null">
                AND c.tenant_id = #{tenantId}
            </if>
            <if test="appId!=null">
                AND c.app_id =#{appId}
            </if>
            order by c.updated_time desc
    </select>

</mapper>
